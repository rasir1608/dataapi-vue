webpackJsonp([3],{"2KZm":function(t,e){},"49W0":function(t,e){},ihaF:function(t,e,a){"use strict";var s={props:{item:{type:Object,default:function(){return{projectName:"项目1",remarks:" 此处为项目描述：项目描述",creator:"rasir",createTime:"2018-06-30",power:""}}}},data:function(){return{}},methods:{canApply:function(t){return!/^\d$/.test(t.power)}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list-item-wrap"},[a("div",{staticClass:"list-item"},[a("div",{staticClass:"item-title"},[t._v(t._s(t.item.projectName))]),a("div",{staticClass:"item-main"},[t._v(t._s(t.item.remarks))]),a("div",{staticClass:"item-footer"},[a("div",{staticClass:"form-item-5"},[a("div",{staticClass:"label"},[t._v("创建人：")]),a("div",{staticClass:"input"},[t._v(t._s(t.item.creatorName))])]),a("div",{staticClass:"form-item-5"},[a("div",{staticClass:"label"},[t._v("创建时间：")]),a("div",{staticClass:"input"},[t._v(t._s(t.item.createTime))])])])]),a("div",{staticClass:"list-item-cover"},[a("div",{staticClass:"list-item-btns"},[t.canApply(t.item)?a("span",{on:{click:function(e){t.$emit("apply")}}},[t._v("申请")]):t._e(),t.item.power>1?a("span",{on:{click:function(e){t.$router.push("/project/edite/"+t.item.projectId)}}},[t._v("编辑")]):t._e(),5===t.item.power?a("span",{on:{click:function(e){t.$emit("delete")}}},[t._v("删除")]):t._e(),a("span",{on:{click:function(e){t.$router.push("/project/detail/"+t.item.projectId)}}},[t._v("查看")])])])])},staticRenderFns:[]};var i=a("VU/8")(s,r,!1,function(t){a("2KZm")},null,null);e.a=i.exports},qEUp:function(t,e){},w5KX:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Xxa5"),r=a.n(s),i=a("exGp"),o=a.n(i),n=a("gRE1"),c=a.n(n),l=a("Dd8w"),u=a.n(l),p=a("NYxO"),d=a("/vUH"),m={data:function(){return{defaultHeader:"/static/image/hello_kiity.jpg",uploadHeaderUrl:"/dataapi/duser/upload",headerData:{fileName:""},passwordShow:!1,userNameShow:!1,isMyApply:!0,newUserName:"",pwData:{oldPw:"",newPw:"",makePw:""}}},watch:{passwordShow:function(t){t||(this.pwData={oldPw:"",newPw:"",makePw:""})},userNameShow:function(t){t||(this.newUserName="")},isMyApply:function(){this.updateProjectList()}},computed:u()({},Object(p.b)(["userInfo","myApplingProjects","applyMineProjects"])),mounted:function(){this.updateProjectList()},methods:{beforeUploadHeader:function(t){var e=t.type;return/^image\b/.test(e)?(this.headerData.fileName=t.name,!0):(this.$message.error("请上传图片格式的文件"),!1)},uploadHeaderSuccess:function(t){if(t.ok){var e="?"+Math.floor(1e6*Math.random());this.userInfo.headerurl=t.data+e,this.$store.commit("SET_USER_INFO",this.userInfo),this.$message.success(t.msg||"头像上传成功")}else this.$message.error(t.msg||"头像上传失败")},uploadHeaderError:function(t){this.$message.error(t||"头像上传失败")},checkPw:function(t){return Object(d.a)(this.pwData,!1)[t]()?"input-success":"input-error"},checkUserName:function(){return Object(d.b)(this.newUserName,!1)?"input-success":"input-error"},updateUserName:function(){Object(d.b)(this.newUserName,!0)&&(this.$store.dispatch("updateUserName",this.newUserName),this.userNameShow=!1)},updatePw:function(){if(c()(Object(d.a)(this.pwData,!0)).every(function(t){return t()})){var t=this.pwData,e=t.oldPw,a=t.newPw;this.$store.dispatch("updatePasswrod",{oldPassword:e,newPassword:a}),this.passwordShow=!1}},updateProjectList:function(){this.isMyApply?this.$store.dispatch("getMyApplyProjects"):this.$store.dispatch("getMpplyMineProjects")},cancelApply:function(t){var e=this;this.$alert("该操作将永久删除该申请流程是否继续？","提示",{showCancelButton:!0,callback:function(a){var s=this;return o()(r.a.mark(function i(){return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if("confirm"!==a){s.next=4;break}return s.next=3,e.$store.dispatch("deletePower",t.id);case 3:e.updateProjectList();case 4:case"end":return s.stop()}},i,s)}))()}})},passProcess:function(t){var e=this;this.$alert("是否确认批准用户申请？","提示",{showCancelButton:!0,callback:function(a){var s=this;return o()(r.a.mark(function i(){var o,n;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if("confirm"!==a){s.next=5;break}return o=t.applicantId,n=t.projectId,s.next=4,e.$store.dispatch("passProcess",{userId:o,projectId:n});case 4:e.updateProjectList();case 5:case"end":return s.stop()}},i,s)}))()}})},dismissProcess:function(t){var e=this;this.$alert("是否确认驳回用户申请？","提示",{showCancelButton:!0,callback:function(a){var s=this;return o()(r.a.mark(function i(){return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if("confirm"!==a){s.next=4;break}return s.next=3,e.$store.dispatch("dismissProcess",t.id);case 3:e.updateProjectList();case 4:case"end":return s.stop()}},i,s)}))()}})}}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mine-header"},[a("div",{staticClass:"mine-info"},[a("img",{attrs:{src:t.userInfo.headerurl||t.defaultHeader}}),a("div",{staticClass:"info-detail"},[a("div",{staticClass:"info-show"},[a("div",{staticClass:"form-item-2"},[a("div",{staticClass:"label"},[t._v("帐号：")]),a("div",{staticClass:"input"},[t._v(t._s(t.userInfo.account))])]),a("div",{staticClass:"form-item-2"},[a("div",{staticClass:"label"},[t._v("昵称：")]),a("div",{staticClass:"input"},[t._v(t._s(t.userInfo.name))])])]),a("div",{staticClass:"info-acitons"},[a("el-upload",{attrs:{action:t.uploadHeaderUrl,multiple:!1,"show-file-list":!1,name:"file",data:t.headerData,"before-upload":t.beforeUploadHeader,"on-success":t.uploadHeaderSuccess,"on-error":t.uploadHeaderError}},[a("el-button",[t._v("上传新头像")])],1),a("el-button",{on:{click:function(e){t.passwordShow=!0}}},[t._v("修改密码")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.userNameShow=!0}}},[t._v("修改昵称")])],1)])]),a("div",{staticClass:"mine-process"},[a("div",{staticClass:"process-actions"},[a("el-button",{attrs:{type:t.isMyApply?"primary":""},on:{click:function(e){t.isMyApply=!0}}},[t._v("我申请的")]),a("el-button",{attrs:{type:t.isMyApply?"":"primary"},on:{click:function(e){t.isMyApply=!1}}},[t._v("申请我的")])],1),a("div",{staticClass:"process-list"},[t.isMyApply?a("el-table",{staticClass:"process-table",staticStyle:{width:"100%"},attrs:{height:"180",data:t.myApplingProjects}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),a("el-table-column",{attrs:{prop:"projectName",label:"项目名称","min-width":"70","show-overflow-tooltip":"show-overflow-tooltip"}}),a("el-table-column",{attrs:{prop:"projectId",label:"项目编号","min-width":"70","show-overflow-tooltip":"show-overflow-tooltip"}}),a("el-table-column",{attrs:{prop:"projectCreatorName",label:"创建人","min-width":"70","show-overflow-tooltip":"show-overflow-tooltip"}}),a("el-table-column",{attrs:{prop:"remarks",label:"备注","min-width":"130","show-overflow-tooltip":"show-overflow-tooltip"}}),a("el-table-column",{attrs:{prop:"createTime",label:"申请时间","min-width":"90","show-overflow-tooltip":"show-overflow-tooltip"},scopedSlots:t._u([{key:"default",fn:function(e){return a("span",{},[t._v(t._s(t._f("formatDate")(e.row.createTime,"YYYY-MM-DD")))])}}])}),a("el-table-column",{attrs:{label:"操作","min-width":"60",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",icon:"el-icon-delete",title:"撤销"},on:{click:function(a){t.cancelApply(e.row)}}})]}}])})],1):a("el-table",{staticClass:"process-table",staticStyle:{width:"100%"},attrs:{height:"180",data:t.applyMineProjects}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),a("el-table-column",{attrs:{prop:"projectName",label:"项目名称","min-width":"70","show-overflow-tooltip":"show-overflow-tooltip"}}),a("el-table-column",{attrs:{prop:"projectId",label:"项目编号","min-width":"70","show-overflow-tooltip":"show-overflow-tooltip"}}),a("el-table-column",{attrs:{prop:"applicantName",label:"申请人","min-width":"70","show-overflow-tooltip":"show-overflow-tooltip"}}),a("el-table-column",{attrs:{prop:"remarks",label:"备注","min-width":"130","show-overflow-tooltip":"show-overflow-tooltip"}}),a("el-table-column",{attrs:{prop:"createTime",label:"申请时间","min-width":"90","show-overflow-tooltip":"show-overflow-tooltip"},scopedSlots:t._u([{key:"default",fn:function(e){return a("span",{},[t._v(t._s(t._f("formatDate")(e.row.createTime,"YYYY-MM-DD")))])}}])}),a("el-table-column",{attrs:{label:"操作","min-width":"60",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",icon:"el-icon-check",title:"通过"},on:{click:function(a){t.passProcess(e.row)}}}),a("el-button",{attrs:{type:"text",icon:"el-icon-close",title:"驳回"},on:{click:function(a){t.dismissProcess(e.row)}}})]}}])})],1)],1)]),a("el-dialog",{attrs:{title:"修改密码",visible:t.passwordShow,width:"30%"},on:{"update:visible":function(e){t.passwordShow=e}}},[a("div",[a("div",{staticClass:"form-item-5"},[a("div",{staticClass:"label"},[t._v("原密码：")]),a("div",{staticClass:"input",class:t.checkPw("oldPw")},[a("el-input",{attrs:{type:"password"},model:{value:t.pwData.oldPw,callback:function(e){t.$set(t.pwData,"oldPw",e)},expression:"pwData.oldPw"}})],1)]),a("div",{staticClass:"form-item-5"},[a("div",{staticClass:"label"},[t._v("新密码：")]),a("div",{staticClass:"input",class:t.checkPw("newPw")},[a("el-input",{attrs:{type:"password"},model:{value:t.pwData.newPw,callback:function(e){t.$set(t.pwData,"newPw",e)},expression:"pwData.newPw"}})],1)]),a("div",{staticClass:"form-item-5"},[a("div",{staticClass:"label"},[t._v("确认密码：")]),a("div",{staticClass:"input",class:t.checkPw("makePw")},[a("el-input",{attrs:{type:"password"},model:{value:t.pwData.makePw,callback:function(e){t.$set(t.pwData,"makePw",e)},expression:"pwData.makePw"}})],1)])]),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.passwordShow=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.updatePw}},[t._v("确定")])],1)]),a("el-dialog",{attrs:{title:"修改昵称",visible:t.userNameShow,width:"30%"},on:{"update:visible":function(e){t.userNameShow=e}}},[a("div",[a("div",{staticClass:"form-item-5"},[a("div",{staticClass:"label"},[t._v("原昵称：")]),a("div",{staticClass:"input"},[t._v(t._s(t.userInfo.name))])]),a("div",{staticClass:"form-item-5"},[a("div",{staticClass:"label"},[t._v("新昵称：")]),a("div",{staticClass:"input",class:t.checkUserName()},[a("el-input",{model:{value:t.newUserName,callback:function(e){t.newUserName=e},expression:"newUserName"}})],1)])]),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.userNameShow=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.updateUserName}},[t._v("确定")])],1)])],1)},staticRenderFns:[]};var h=a("VU/8")(m,f,!1,function(t){a("49W0")},null,null).exports,w=a("fZjL"),v=a.n(w),P=a("ihaF"),b=a("zL8q"),j={components:{ListItem:P.a},data:function(){return{newProjectName:"",searchProject:{name:"",size:5,currentPage:1}}},watch:{"searchProject.currentPage":{handler:function(){this.searchProjectList()}}},computed:u()({},Object(p.b)(["userInfo","myProjects"])),created:function(){this.searchProject.size=Math.floor(window.innerWidth/220),this.resetPageAndSearch()},mounted:function(){this.bindKeyEnter(this.$refs.projectNameSearchInputWrap)},methods:{createProject:function(){if(e=this.newProjectName,a=!0,!/^\s*$/.test(e)||(a&&b.Message.error(s||"请输入合法的项目名称"),0)){var t={name:this.newProjectName,creator:this.userInfo.id,modifier:this.userInfo.id,remarks:"",model:"",ui:"",web:"",createTime:Date.now(),updateTime:Date.now()};this.$store.dispatch("saveProject",t)}var e,a,s},searchProjectList:function(){var t=this;return o()(r.a.mark(function e(){var a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={},v()(t.searchProject).forEach(function(e){(t.searchProject[e]||0===t.searchProject[e])&&(a[e]=t.searchProject[e])}),e.next=4,t.$store.dispatch("searchMyProject",a);case 4:case"end":return e.stop()}},e,t)}))()},resetPageAndSearch:function(){var t=this;return o()(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.searchProject.currentPage){e.next=5;break}return e.next=3,t.searchProjectList();case 3:e.next=6;break;case 5:t.searchProject.currentPage=1;case 6:case"end":return e.stop()}},e,t)}))()},bindKeyEnter:function(t){var e=this;t.$refs.input.addEventListener("keypress",function(t){13===t.keyCode&&e.resetPageAndSearch()})},deleteProject:function(t){if(5===t.power){var e=this;this.$alert("该操作将永久删除该项目，以及相关数据，是否继续？","提示",{showCancelButton:!0,callback:function(a){var s=this;return o()(r.a.mark(function i(){return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if("confirm"!==a){s.next=5;break}return s.next=3,e.$store.dispatch("deleteProject",t.projectId);case 3:return s.next=5,e.searchProjectList();case 5:case"end":return s.stop()}},i,s)}))()}})}else this.$message.error("只有项目管理员才能删除项目")}}},y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mine-main"},[a("div",{staticClass:"mine-projects"},[a("div",{staticClass:"mine-projects-form"},[a("div",{staticClass:"form-left"},[a("div",{staticClass:"form-item-1"},[a("div",{staticClass:"label"},[t._v("我的项目：")]),a("div",{staticClass:"input"},[a("el-input",{attrs:{placeholder:"输入项目名称"},on:{blur:function(e){t.newProjectName=t.trimStr(t.newProjectName)}},model:{value:t.newProjectName,callback:function(e){t.newProjectName=e},expression:"newProjectName"}})],1)]),a("el-button",{attrs:{type:"primary"},on:{click:t.createProject}},[t._v("创建新项目")])],1),a("div",{staticClass:"form-right"},[a("el-input",{ref:"projectNameSearchInputWrap",attrs:{placeholder:"搜索项目名称","suffix-icon":"el-icon-search"},on:{blur:function(e){t.searchProject.name=t.trimStr(t.searchProject.name)}},model:{value:t.searchProject.name,callback:function(e){t.$set(t.searchProject,"name",e)},expression:"searchProject.name"}}),a("el-button",{attrs:{type:"primary"},on:{click:t.resetPageAndSearch}},[t._v("搜索")])],1)]),t.myProjects.list.length?a("div",{staticClass:"mine-projects-table"},t._l(t.myProjects.list,function(e,s){return a("list-item",{key:s,attrs:{item:e},on:{delete:function(a){t.deleteProject(e)}}})})):a("div",{staticClass:"mine-projects-empty"},[t._v("暂无数据")])]),t.myProjects.total?a("div",{staticClass:"mine-projects-pagination"},[a("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper","page-size":t.searchProject.size,"current-page":t.searchProject.currentPage,total:t.myProjects.total},on:{"update:currentPage":function(e){t.$set(t.searchProject,"currentPage",e)}}})],1):t._e()])},staticRenderFns:[]};var _={components:{MineHeader:h,MineMain:a("VU/8")(j,y,!1,function(t){a("qEUp")},null,null).exports}},k={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"mine"},[e("mine-header"),e("mine-main")],1)},staticRenderFns:[]};var C=a("VU/8")(_,k,!1,function(t){a("xsHa")},null,null);e.default=C.exports},xsHa:function(t,e){}});
//# sourceMappingURL=3.7b953bc0fd6efeca47ec.js.map