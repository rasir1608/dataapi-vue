webpackJsonp([2],{"6KpM":function(e,t){},FYsb:function(e,t){},GKwd:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("fZjL"),n=r.n(a),s=r("Xxa5"),i=r.n(s),o=r("exGp"),c=r.n(o),l=r("Dd8w"),u=r.n(l),d=r("NYxO"),p=r("woOf"),f=r.n(p),m={props:["model","show"],data:function(){return{modelShow:!1}},watch:{show:function(e){this.modelShow=e},modelShow:function(e){this.$emit("update:show",e)},currentProject:{handler:function(e){this.model.url=e[this.model.tag]},deep:!0}},computed:u()({},Object(d.b)(["currentProject"])),methods:{beforeUpload:function(e){var t=e.type;return!!/^image\b/.test(t)||(this.$message.error("请上传图片格式的文件"),!1)},uploadSuccess:function(e){e.ok?(this.model.url=e.data,this.currentProject[this.model.tag]=e.data,this.$store.commit("SET_CURRENT_PROJECT",this.currentProject),this.$message.success("图片上传成功")):this.$message.error(e.msg||"图片上传失败")},uploadError:function(e){this.$message.error(e)},updateUrl:function(){var e=this.model,t=e.url,r=e.tag;this.$store.dispatch("updateUrl",{tag:r,url:t,projectId:this.currentProject.id})}}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"models-dialog"},[r("el-dialog",{attrs:{title:e.model.title,visible:e.modelShow,width:"30%"},on:{"update:visible":function(t){e.modelShow=t}}},[r("main",[r("div",{staticClass:"form-item-5"},[r("div",{staticClass:"label"},[e._v("url：")]),r("div",{staticClass:"input"},[r("el-input",{on:{blur:function(t){e.model.url=e.trimStr(e.model.url)}},model:{value:e.model.url,callback:function(t){e.$set(e.model,"url",t)},expression:"model.url"}})],1)])]),r("footer",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.modelShow=!1}}},[e._v("取消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.updateUrl}},[e._v("修改")]),r("el-upload",{attrs:{action:e.model.path,multiple:!1,"show-file-list":!1,name:"file","before-upload":e.beforeUpload,"on-success":e.uploadSuccess,"on-error":e.uploadError}},[r("el-button",{attrs:{type:"primary"}},[e._v("上传图片")])],1)],1)])],1)},staticRenderFns:[]};var v=r("VU/8")(m,h,!1,function(e){r("6KpM")},null,null).exports,b={props:["show","projectId","isEdite"],data:function(){return{membersShow:!1,loading:!1,addUserId:"",userList:[],membersList:[]}},watch:{show:function(e){this.membersShow=e,e&&this.getMembers()},membersShow:function(e){this.$emit("update:show",e)}},computed:u()({},Object(d.b)(["currentProject","userList4add","membersList4project"])),created:function(){},methods:{getMembers:function(){var e=this;return c()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("getMembers4project",e.currentProject.id);case 2:case"end":return t.stop()}},t,e)}))()},getUserList:function(e){var t=this;return c()(i.a.mark(function r(){return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=3;break}return t.$store.commit("SET_USER_LIST_4_ADD",[]),r.abrupt("return");case 3:return r.next=5,t.$store.dispatch("getUserList4add",e);case 5:case"end":return r.stop()}},r,t)}))()},addMember:function(){var e=this;return c()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.addUserId){t.next=2;break}return t.abrupt("return");case 2:if(!(e.membersList4project.findIndex(function(t){return t.id===e.addUserId})>-1)){t.next=5;break}return e.$message.error("该用户已经在项目中，无需重复添加"),t.abrupt("return");case 5:return r={userId:e.addUserId,projectId:e.currentProject.id},t.next=8,e.$store.dispatch("addUser2project",r);case 8:return t.next=10,e.getMembers();case 10:case"end":return t.stop()}},t,e)}))()},removeUser:function(e){var t=this;this.$alert("该操作将永久删除用户，是否继续？","提示",{callback:function(r){var a=this;return c()(i.a.mark(function n(){return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("confirm"!==r){a.next=5;break}return a.next=3,t.$store.dispatch("removerUser",e.powerId);case 3:return a.next=5,t.getMembers();case 5:case"end":return a.stop()}},n,a)}))()}})},beforeClose:function(){this.addUserId="",this.$store.commit("SET_USER_LIST_4_ADD",[])}}},w={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"project-members-dialog"},[r("el-dialog",{attrs:{width:"500px",title:"项目协作人",visible:e.membersShow},on:{"update:visible":function(t){e.membersShow=t},close:e.beforeClose}},[r("main",[e.isEdite?r("div",{staticClass:"add-members"},[r("el-select",{attrs:{clearable:"clearable",remote:"remote",filterable:"filterable",placeholder:"请输入用户昵称","remote-method":e.getUserList,loading:e.loading,"default-first-option":"default-first-option"},on:{change:e.addMember},model:{value:e.addUserId,callback:function(t){e.addUserId=t},expression:"addUserId"}},[r("i",{staticClass:"el-icon-search",attrs:{slot:"prefix"},slot:"prefix"}),e._l(e.userList4add,function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.id}})})],2)],1):e._e(),r("div",{staticClass:"members-list"},[r("el-table",{staticClass:"process-table",staticStyle:{width:"100%"},attrs:{data:e.membersList4project,height:"300"}},[r("el-table-column",{attrs:{type:"index",width:"50",label:"序号"}}),r("el-table-column",{attrs:{prop:"userId",label:"用户ID"}}),r("el-table-column",{attrs:{prop:"userName",label:"用户名"}}),r("el-table-column",{attrs:{prop:"power",label:"权限"},scopedSlots:e._u([{key:"default",fn:function(t){return r("span",{},[e._v(e._s(e._f("powerMap")(t.row.power)))])}}])}),e.isEdite?r("el-table-column",{attrs:{label:"操作",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return r("i",{staticClass:"el-icon-delete",on:{click:function(r){e.removeUser(t.row)}}})}}])}):e._e()],1)],1)])])],1)},staticRenderFns:[]};var j={components:{ModelsDialog:v,ProjectMembersDialog:r("VU/8")(b,w,!1,function(e){r("L51o")},null,null).exports},props:["isEdite","search"],data:function(){return{newInterfaceName:"",modelsShow:!1,membersShow:!1,autoSaveTimeout:24e4,modelData:{tag:"",title:"",url:"",path:""}}},watch:{isEdite:function(e){e&&this.currentProject.power>1?this.beginAutoSaveTimer():this.closeTimer()}},computed:u()({},Object(d.b)(["currentProject","userInfo","proSaveLoading"])),created:function(){this.beginAutoSaveTimer()},beforeRouteLeave:function(e,t,r){t.params.autoSaveTimer&&clearTimeout(t.params.autoSaveTimer),r()},methods:{closeTimer:function(){this.$route.params.autoSaveTimer&&clearTimeout(this.$route.params.autoSaveTimer)},beginAutoSaveTimer:function(){var e=this;this.closeTimer(),this.$route.params.autoSaveTimer=setTimeout(function(){e.updateProject()},this.autoSaveTimeout)},updateProject:function(){var e=this;return c()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.closeTimer(),!(e.currentProject.power<2)){t.next=4;break}return e.$message.error("您没有项目修改权限"),t.abrupt("return");case 4:return t.next=6,e.$store.dispatch("updateProject",e.currentProject);case 6:e.beginAutoSaveTimer();case 7:case"end":return t.stop()}},t,e)}))()},endEdite:function(){var e=this;return c()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("unlockEdite",e.currentProject.editeId);case 2:e.$router.push("/project/detail/"+e.currentProject.id);case 3:case"end":return t.stop()}},t,e)}))()},showEditeDialog:function(e){if(this.currentProject.power<2)this.$message.error("您没有项目修改权限");else{this.modelData={tag:e,title:{model:"项目原型",ui:"UI设计",web:"web预览"}[e],url:this.currentProject[e],path:"/dataapi/dproject/upload/"+e+"/"+this.currentProject.id},this.modelsShow=!0}},resetSearch:function(){f()(this.search,{id:"",name:""}),this.searchInter()},searchInter:function(){this.$emit("search")},createInterface:function(){var e=this;return c()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!/^\s*$/.test(e.newInterfaceName)){t.next=3;break}return e.$message.error("请先输入新接口的名称"),t.abrupt("return");case 3:return r={name:e.newInterfaceName,creator:e.userInfo.id,modifier:e.userInfo.id,project:e.currentProject.id,createTime:Date.now(),updateTime:Date.now()},t.next=6,e.$store.dispatch("createInterface",r);case 6:case"end":return t.stop()}},t,e)}))()},editeProject:function(){this.$router.push("/project/edite/"+this.currentProject.id)},canEdite:function(){return this.isEdite&&this.currentProject.power>1}}},g={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"project-header"},[r("div",{staticClass:"project-info"},[r("div",{staticClass:"project-name form-item-5"},[r("div",{staticClass:"label"},[r("span",[e._v("项目名称：")]),e.canEdite()?r("el-button",{attrs:{type:"primary",loading:e.proSaveLoading},on:{click:e.updateProject}},[e._v("保存")]):e._e(),e.canEdite()?r("el-button",{attrs:{type:"primary"},on:{click:e.endEdite}},[e._v("解除锁定")]):e._e()],1),r("div",{staticClass:"input"},[r("div",[e._v(e._s(e.currentProject.name))])])]),r("div",{staticClass:"project-other"},[r("div",{staticClass:"project-items"},[r("div",{staticClass:"form-item-2"},[r("div",{staticClass:"label"},[e._v("项目编号：")]),r("div",{staticClass:"input"},[e._v(e._s(e.currentProject.id))])]),r("div",{staticClass:"form-item-2"},[r("div",{staticClass:"label"},[e._v("创建时间：")]),r("div",{staticClass:"input"},[e._v(e._s(e._f("formatDate")(e.currentProject.createTime,"YYYY-MM-DD")))])]),r("div",{staticClass:"form-item-2"},[r("div",{staticClass:"label"},[e._v("创建人：")]),r("div",{staticClass:"input"},[e._v(e._s(e.currentProject.creatorName))])])]),r("div",{staticClass:"project-models"},[r("span",[e.canEdite()?r("a",{on:{click:function(t){e.showEditeDialog("model")}}},[e._v("原型")]):r("span",[e.currentProject.model?r("a",{attrs:{href:e.currentProject.model,target:"_blank"}},[e._v("原型")]):r("span",[e._v("暂无原型")])])]),r("span",[e.canEdite()?r("a",{on:{click:function(t){e.showEditeDialog("ui")}}},[e._v("UI")]):r("span",[e.currentProject.ui?r("a",{attrs:{href:e.currentProject.ui,target:"_blank"}},[e._v("UI")]):r("span",[e._v("暂无UI")])])]),r("span",[e.canEdite()?r("a",{on:{click:function(t){e.showEditeDialog("web")}}},[e._v("WEB")]):r("span",[e.currentProject.web?r("a",{attrs:{href:e.currentProject.web,target:"_blank"}},[e._v("WEB")]):r("span",[e._v("暂无WEB")])])]),r("span",[r("a",{on:{click:function(t){e.membersShow=!0}}},[e._v("项目协作人")])])])]),r("div",{staticClass:"project-remark"},[r("div",{staticClass:"form-item-5"},[r("div",{staticClass:"label"},[e._v("备注：")]),r("div",{staticClass:"input"},[e.canEdite()?r("el-input",{attrs:{placeholder:"请输入项目备注",type:"textarea"},model:{value:e.currentProject.remarks,callback:function(t){e.$set(e.currentProject,"remarks",t)},expression:"currentProject.remarks"}}):r("div",[e._v(e._s(e.currentProject.remarks))])],1)])])]),r("div",{staticClass:"project-interface-search"},[e.canEdite()?r("div",{staticClass:"project-interface-ctrol"},[r("el-input",{attrs:{placeholder:"请输入新接口名称"},model:{value:e.newInterfaceName,callback:function(t){e.newInterfaceName=t},expression:"newInterfaceName"}}),r("el-button",{attrs:{type:"primary"},on:{click:e.createInterface}},[e._v("创建接口")])],1):e._e(),!e.isEdite&&e.currentProject.power>1?r("div",{staticClass:"project-interface-edite"},[r("el-button",{attrs:{type:"primary"},on:{click:e.editeProject}},[e._v("编辑项目")])],1):e._e(),r("div",{staticClass:"project-interface-form"},[r("div",{staticClass:"project-interface-form-items"},[r("div",{staticClass:"form-item-1"},[r("div",{staticClass:"label"},[e._v("接口ID：")]),r("div",{staticClass:"input"},[r("el-input",{attrs:{placeholder:"请输入接口ID"},model:{value:e.search.id,callback:function(t){e.$set(e.search,"id",t)},expression:"search.id"}})],1)]),r("div",{staticClass:"form-item-1"},[r("div",{staticClass:"label"},[e._v("接口名称：")]),r("div",{staticClass:"input"},[r("el-input",{attrs:{placeholder:"请输入接口名称"},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}})],1)])]),r("div",{staticClass:"project-interface-form-submits"},[r("el-button",{on:{click:e.resetSearch}},[e._v("重置")]),r("el-button",{attrs:{type:"primary"},on:{click:e.searchInter}},[e._v("查询")])],1)])]),r("models-dialog",{attrs:{show:e.modelsShow,model:e.modelData},on:{"update:show":function(t){e.modelsShow=t}}}),r("project-members-dialog",{attrs:{show:e.membersShow,"is-edite":e.canEdite()},on:{"update:show":function(t){e.membersShow=t}}})],1)},staticRenderFns:[]};var _=r("VU/8")(j,g,!1,function(e){r("FYsb")},null,null).exports,P={props:["isEdite","search"],data:function(){return{}},computed:u()({},Object(d.b)(["interfaceData"])),methods:{sizeChange:function(e){this.search.size=e},canEdite:function(e){return this.isEdite&&e.power>1}}},k={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"project-main"},[r("div",{staticClass:"project-interface-list"},[e._m(0),r("div",{staticClass:"project-interface-list-table"},[r("el-table",{staticClass:"interface-table",attrs:{data:e.interfaceData.list,stripe:"stripe"}},[r("el-table-column",{attrs:{label:"序号",type:"index"}}),r("el-table-column",{attrs:{label:"接口ID",prop:"id","min-width":"60"}}),r("el-table-column",{attrs:{label:"接口名称",prop:"name","min-width":"100","show-overflow-tooltip":"show-overflow-tooltip"}}),r("el-table-column",{attrs:{label:"Method",prop:"method","min-width":"70"}}),r("el-table-column",{attrs:{label:"URL",prop:"path","min-width":"180","show-overflow-tooltip":"show-overflow-tooltip"}}),r("el-table-column",{attrs:{label:"Content-type",prop:"contentType","min-width":"150","show-overflow-tooltip":"show-overflow-tooltip"}}),r("el-table-column",{attrs:{label:"描述",prop:"remarks","min-width":"180","show-overflow-tooltip":"show-overflow-tooltip"}}),r("el-table-column",{attrs:{label:"创建人",prop:"creatorName","min-width":"80"}}),r("el-table-column",{attrs:{label:"创建时间",prop:"createTime","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return r("span",{},[e._v(e._s(e._f("formatDate")(t.row.createTime,"YYYY-MM-DD")))])}}])}),r("el-table-column",{attrs:{label:"操作","min-width":"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.canEdite(t.row)?r("el-button",{attrs:{type:"text",icon:"el-icon-edit",title:"编辑"},on:{click:function(r){e.$router.push("/project/interface/edite/"+t.row.id)}}}):e._e(),e.canEdite(t.row)?r("el-button",{attrs:{type:"text",icon:"el-icon-delete",title:"删除"},on:{click:function(r){e.$emit("delete",t.row)}}}):e._e(),r("el-button",{attrs:{type:"text",icon:"el-icon-view",title:"查看详情"},on:{click:function(r){e.$router.push("/project/interface/detail/"+t.row.id)}}})]}}])})],1)],1)]),e.interfaceData.total?r("div",{staticClass:"project-interface-pagination"},[r("el-pagination",{attrs:{layout:"total, prev, pager, next,sizes, jumper","page-sizes":[10,20,30,40],"page-size":e.search.size,"current-page":e.search.currentPage,total:e.interfaceData.total},on:{"size-change":e.sizeChange,"update:currentPage":function(t){e.$set(e.search,"currentPage",t)}}})],1):e._e()])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"project-interface-list-title"},[t("span",[this._v("接口列表：")])])}]};var x={components:{ProjectHeader:_,ProjectMain:r("VU/8")(P,k,!1,function(e){r("vokK")},null,null).exports},data:function(){return{isEdite:!1,searchInterface:{id:"",name:"",size:10,currentPage:1}}},watch:{"searchInterface.size":{handler:function(){this.resetCurrentPage()},deep:!0},"searchInterface.currentPage":{handler:function(){this.getInterfaceList()},deep:!0},$route:{handler:function(){this.loadProjectData()},deep:!0}},computed:u()({},Object(d.b)(["currentProject","interfaceData","editeDetail","userInfo"])),created:function(){var e=this;return c()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.loadProjectData();case 2:return t.next=4,e.resetCurrentPage();case 4:case"end":return t.stop()}},t,e)}))()},mounted:function(){},methods:{getInterfaceList:function(){var e=this;return c()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={},n()(e.searchInterface).forEach(function(t){(e.searchInterface[t]||0===e.searchInterface[t])&&(r[t]=e.searchInterface[t])}),r.project=e.currentProject.id,t.next=5,e.$store.dispatch("getInterfaceList",r);case 5:0===e.interfaceData.list.length&&e.interfaceData.total>0&&e.searchInterface.currentPage>1&&(e.searchInterface.currentPage-=1);case 6:case"end":return t.stop()}},t,e)}))()},resetCurrentPage:function(){var e=this;return c()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(1!==e.searchInterface.currentPage){t.next=5;break}return t.next=3,e.getInterfaceList();case 3:t.next=6;break;case 5:e.searchInterface.currentPage=1;case 6:case"end":return t.stop()}},t,e)}))()},deleteInterface:function(e){var t=this;this.$alert("该操作将永久删除接口信息，是否继续？","提示",{showCancelButton:!0,callback:function(r){var a=this;return c()(i.a.mark(function n(){return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("confirm"!==r){a.next=5;break}return a.next=3,t.$store.dispatch("deleteInterface",e.id);case 3:return a.next=5,t.getInterfaceList();case 5:case"end":return a.stop()}},n,a)}))()}})},loadProjectData:function(){var e=this;return c()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.isEdite=/edite/.test(e.$route.path),r=Number(e.$route.params.id),t.next=4,e.$store.dispatch("getProjectById",r);case 4:if(!e.isEdite||!e.currentProject.id){t.next=26;break}if(!(e.currentProject.power<2)){t.next=10;break}e.$message.error("您没有编辑该项目的权限"),e.$router.push("/project/detail/"+e.currentProject.id),t.next=26;break;case 10:if(/^\d+$/.test(e.currentProject.editeId)){t.next=17;break}return t.next=13,e.$store.dispatch("createEdite",{kind:0,target:r});case 13:return t.next=15,e.$store.dispatch("getProjectById",r);case 15:t.next=26;break;case 17:if(1!==e.currentProject.islock||e.currentProject.editor===e.userInfo.id){t.next=22;break}e.$message.error("该项目正在被"+e.currentProject.editorName+"编辑，您暂时无法编辑！"),e.$router.push("/project/detail/"+e.currentProject.id),t.next=26;break;case 22:return t.next=24,e.$store.dispatch("lockEdite",e.currentProject.editeId);case 24:return t.next=26,e.$store.dispatch("getProjectById",r);case 26:case"end":return t.stop()}},t,e)}))()}}},I={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"project-detail"},[t("project-header",{attrs:{"is-edite":this.isEdite,search:this.searchInterface},on:{search:this.resetCurrentPage}}),t("project-main",{attrs:{"is-edite":this.isEdite,search:this.searchInterface},on:{delete:this.deleteInterface}})],1)},staticRenderFns:[]};var C=r("VU/8")(x,I,!1,function(e){r("RgMd")},null,null);t.default=C.exports},L51o:function(e,t){},RgMd:function(e,t){},vokK:function(e,t){}});
//# sourceMappingURL=2.c81f105fa14d4218e64d.js.map